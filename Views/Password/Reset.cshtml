@model ResetVm
@{
    Layout = null; ViewData["Title"] = "Cambio de contraseña";
}
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
<div class="container py-4" style="min-height:100vh;display:flex;align-items:center;justify-content:center;background:
    linear-gradient(rgba(255,255,255,.35),rgba(255,255,255,.35)), url('/img/login/fondo.jpg') center/cover no-repeat;">
    <div class="card shadow" style="max-width:760px;width:100%;background:rgba(255,255,255,.92)">
        <div class="card-body p-4">
            <h4 class="mb-3 fw-bold">Cambio de contraseña</h4>
            <form asp-action="Reset" method="post" novalidate>
                @Html.AntiForgeryToken()
                <input type="hidden" asp-for="Uid" />
                <input type="hidden" asp-for="Token" />

                <div class="row g-3">
                    <div class="col-12 col-md-6">
                        <label class="form-label fw-semibold">Nueva contraseña</label>
                        <input asp-for="NuevaContrasena" id="NuevaContrasena" type="password" class="form-control" autocomplete="new-password" />
                        <span asp-validation-for="NuevaContrasena" class="text-danger"></span>
                        <ul class="small mt-2 mb-0" id="pwChecklist">
                            <li data-req="lower">Al menos una minúscula</li>
                            <li data-req="upper">Al menos una mayúscula</li>
                            <li data-req="digit">Al menos un número</li>
                            <li data-req="len">Entre 8 y 15 caracteres</li>
                        </ul>
                    </div>
                    <div class="col-12 col-md-6">
                        <label class="form-label fw-semibold">Confirmar contraseña</label>
                        <input asp-for="ConfirmarContrasena" id="ConfirmarContrasena" type="password" class="form-control" autocomplete="new-password" />
                        <span asp-validation-for="ConfirmarContrasena" class="text-danger"></span>
                        <small id="pwMatchMsg" class="form-text"></small>
                    </div>
                </div>

                <div class="mt-3">
                    <button class="btn btn-warning fw-bold">Registrar</button>
                    <a class="btn btn-outline-secondary ms-2" href="/Login/Index">Volver</a>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
    (() => {
      const pwd = document.getElementById('NuevaContrasena');
      const cfm = document.getElementById('ConfirmarContrasena');
      const list= document.getElementById('pwChecklist');
      const msg = document.getElementById('pwMatchMsg');

      const set = (el,ok)=>{ if(!el) return; el.style.color = ok ? '#16803d' : '#b42318'; };

      function checkPwd(){
        const v = pwd?.value || '';
        set(list.querySelector('[data-req="lower"]'), /[a-z]/.test(v));
        set(list.querySelector('[data-req="upper"]'), /[A-Z]/.test(v));
        set(list.querySelector('[data-req="digit"]'), /\d/.test(v));
        set(list.querySelector('[data-req="len"]'), v.length>=8 && v.length<=15);
      }
      function checkMatch(){
        const p = pwd?.value || '';
        const c = cfm?.value || '';
        if(!c){ msg.textContent=''; return; }
        if(p && c && p===c){ msg.textContent='Las contraseñas coinciden'; msg.className='form-text text-success fw-semibold'; }
        else { msg.textContent='Las contraseñas no coinciden'; msg.className='form-text text-danger'; }
      }
      pwd?.addEventListener('input', ()=>{checkPwd();checkMatch();});
      cfm?.addEventListener('input', checkMatch);
      window.addEventListener('DOMContentLoaded', ()=>{checkPwd();});
    })();
</script>
